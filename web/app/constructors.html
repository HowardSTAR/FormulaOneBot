<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö—É–±–æ–∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ ‚Äî FormulaOneBot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
<div class="root">
    <div class="card">
        <button id="btn-back-home" class="btn-back" type="button">‚Üê <span>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</span></button>
        <h2>–ö—É–±–æ–∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤</h2>
        <div class="year-selector" id="year-selector"></div>
        <div id="constructors-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∂–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...</p>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/common.js"></script>
<script>
let currentSeason = new Date().getFullYear();

async function loadConstructors(season) {
    const container = document.getElementById('constructors-content');
    showLoading(container, '–ó–∞–≥—Ä—É–∂–∞—é –∫—É–±–æ–∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤...');

    try {
        const data = await apiRequest('/constructors', { season });
        
        if (!data.constructors || data.constructors.length === 0) {
            showEmpty(container, '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫—É–±–∫—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –∑–∞ —ç—Ç–æ—Ç —Å–µ–∑–æ–Ω', 'üèé');
            return;
        }

        let html = '<div class="standings-list">';
        
        data.constructors.forEach(constructor => {
            const emoji = getPositionEmoji(constructor.position);
            const podiumClass = constructor.position <= 3 ? `podium-${constructor.position} podium` : '';
            const favoriteClass = constructor.is_favorite ? 'favorite' : '';
            
            html += `
                <div class="standings-item ${podiumClass} ${favoriteClass}">
                    <div class="standings-position ${constructor.position <= 3 ? 'podium' : ''}">
                        ${emoji}${constructor.position}
                    </div>
                    <div class="standings-info">
                        <div class="standings-name">
                            ${constructor.is_favorite ? '‚≠êÔ∏è ' : ''}${constructor.name}
                        </div>
                        ${constructor.code ? `<div class="standings-code">${constructor.code}</div>` : ''}
                    </div>
                    <div class="standings-points">${formatPoints(constructor.points)}</div>
                </div>
            `;
        });

        html += '</div>';
        container.innerHTML = html;
    } catch (e) {
        console.error(e);
        showError(container, '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫—É–±–æ–∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤');
    }
}

function initYearSelector() {
    const selector = document.getElementById('year-selector');
    const currentYear = new Date().getFullYear();
    const years = [currentYear - 2, currentYear - 1, currentYear, currentYear + 1];
    
    years.forEach(year => {
        const btn = document.createElement('button');
        btn.className = `year-btn ${year === currentSeason ? 'active' : ''}`;
        btn.textContent = year;
        btn.addEventListener('click', () => {
            currentSeason = year;
            document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadConstructors(year);
        });
        selector.appendChild(btn);
    });
}

document.addEventListener('DOMContentLoaded', () => {
    initTelegram();
    initBackButton('/');
    initYearSelector();
    loadConstructors(currentSeason);
});
</script>
</body>
</html>
