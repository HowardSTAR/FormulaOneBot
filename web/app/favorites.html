<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ ‚Äî FormulaOneBot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
<div class="root">
    <div class="card">
        <button id="btn-back-home" class="btn-back" type="button">‚Üê <span>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</span></button>
        <h2>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h2>
        <p style="color: var(--text-muted); margin-bottom: 12px;">
            –¢–≤–æ–∏ –ª—é–±–∏–º—ã–µ –ø–∏–ª–æ—Ç—ã –∏ –∫–æ–º–∞–Ω–¥—ã. –ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∏—Ö, –∏—Å–ø–æ–ª—å–∑—É–π –±–æ—Ç–∞.
        </p>
        <div id="favorites-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∂–∞—é –∏–∑–±—Ä–∞–Ω–Ω–æ–µ...</p>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/common.js"></script>
<script>
async function loadFavorites() {
    const container = document.getElementById('favorites-content');
    const telegramId = getTelegramId();

    if (!telegramId) {
        showError(container, '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –û—Ç–∫—Ä–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram.');
        return;
    }

    showLoading(container, '–ó–∞–≥—Ä—É–∂–∞—é –∏–∑–±—Ä–∞–Ω–Ω–æ–µ...');

    try {
        const data = await apiRequest('/favorites', { telegram_id: telegramId });
        
        let html = '';

        if (data.drivers && data.drivers.length > 0) {
            html += '<h3 style="margin-top: 16px;">‚≠ê –õ—é–±–∏–º—ã–µ –ø–∏–ª–æ—Ç—ã</h3>';
            html += '<div class="standings-list">';
            data.drivers.forEach(code => {
                html += `
                    <div class="standings-item favorite">
                        <div class="standings-info">
                            <div class="standings-name">‚≠êÔ∏è ${code}</div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
        } else {
            html += '<p style="color: var(--text-muted); margin: 12px 0;">‚≠ê –ü–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø–∏–ª–æ—Ç–æ–≤</p>';
        }

        if (data.teams && data.teams.length > 0) {
            html += '<h3 style="margin-top: 24px;">üèé –õ—é–±–∏–º—ã–µ –∫–æ–º–∞–Ω–¥—ã</h3>';
            html += '<div class="standings-list">';
            data.teams.forEach(team => {
                html += `
                    <div class="standings-item favorite">
                        <div class="standings-info">
                            <div class="standings-name">‚≠êÔ∏è ${team}</div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
        } else {
            html += '<p style="color: var(--text-muted); margin: 12px 0;">üèé –ü–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –∫–æ–º–∞–Ω–¥</p>';
        }

        if (data.drivers.length === 0 && data.teams.length === 0) {
            html = '<div class="empty-state"><div class="empty-state-icon">‚≠ê</div><p>–£ —Ç–µ–±—è –ø–æ–∫–∞ –Ω–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø–∏–ª–æ—Ç–æ–≤ –∏–ª–∏ –∫–æ–º–∞–Ω–¥.<br>–î–æ–±–∞–≤—å –∏—Ö —á–µ—Ä–µ–∑ –±–æ—Ç–∞!</p></div>';
        }

        container.innerHTML = html;
    } catch (e) {
        console.error(e);
        showError(container, '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–±—Ä–∞–Ω–Ω–æ–µ');
    }
}

document.addEventListener('DOMContentLoaded', () => {
    initTelegram();
    initBackButton('/');
    loadFavorites();
});
</script>
</body>
</html>
