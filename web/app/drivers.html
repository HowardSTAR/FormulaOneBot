<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–õ–∏—á–Ω—ã–π –∑–∞—á—ë—Ç –ø–∏–ª–æ—Ç–æ–≤ ‚Äî FormulaOneBot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
<div class="root">
    <div class="card">
        <button id="btn-back-home" class="btn-back" type="button">‚Üê <span>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</span></button>
        <h2>–õ–∏—á–Ω—ã–π –∑–∞—á—ë—Ç –ø–∏–ª–æ—Ç–æ–≤</h2>
        <div class="year-selector" id="year-selector"></div>
        <div id="drivers-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∂–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...</p>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/common.js"></script>
<script>
let currentSeason = new Date().getFullYear();

async function loadDrivers(season) {
    const container = document.getElementById('drivers-content');
    showLoading(container, '–ó–∞–≥—Ä—É–∂–∞—é –ª–∏—á–Ω—ã–π –∑–∞—á—ë—Ç...');

    try {
        const data = await apiRequest('/drivers', { season });
        
        if (!data.drivers || data.drivers.length === 0) {
            showEmpty(container, '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –ª–∏—á–Ω–æ–º—É –∑–∞—á—ë—Ç—É –ø–∏–ª–æ—Ç–æ–≤ –∑–∞ —ç—Ç–æ—Ç —Å–µ–∑–æ–Ω', 'üèé');
            return;
        }

        let html = '<div class="standings-list">';
        
        data.drivers.forEach(driver => {
            const emoji = getPositionEmoji(driver.position);
            const podiumClass = driver.position <= 3 ? `podium-${driver.position} podium` : '';
            const favoriteClass = driver.is_favorite ? 'favorite' : '';
            
            html += `
                <div class="standings-item ${podiumClass} ${favoriteClass}">
                    <div class="standings-position ${driver.position <= 3 ? 'podium' : ''}">
                        ${emoji}${driver.position}
                    </div>
                    <div class="standings-info">
                        <div class="standings-name">
                            ${driver.is_favorite ? '‚≠êÔ∏è ' : ''}${driver.code} ${driver.name}
                        </div>
                        <div class="standings-code">${driver.name}</div>
                    </div>
                    <div class="standings-points">${formatPoints(driver.points)}</div>
                </div>
            `;
        });

        html += '</div>';
        container.innerHTML = html;
    } catch (e) {
        console.error(e);
        showError(container, '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–∏—á–Ω—ã–π –∑–∞—á—ë—Ç –ø–∏–ª–æ—Ç–æ–≤');
    }
}

function initYearSelector() {
    const selector = document.getElementById('year-selector');
    const currentYear = new Date().getFullYear();
    const years = [currentYear - 2, currentYear - 1, currentYear, currentYear + 1];
    
    years.forEach(year => {
        const btn = document.createElement('button');
        btn.className = `year-btn ${year === currentSeason ? 'active' : ''}`;
        btn.textContent = year;
        btn.addEventListener('click', () => {
            currentSeason = year;
            document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            loadDrivers(year);
        });
        selector.appendChild(btn);
    });
}

document.addEventListener('DOMContentLoaded', () => {
    initTelegram();
    initBackButton('/');
    initYearSelector();
    loadDrivers(currentSeason);
});
</script>
</body>
</html>
