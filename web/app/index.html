<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>F1 Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        .section-title {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 24px 0 8px 4px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }
        .hero-btn {
            background: linear-gradient(135deg, var(--primary), #b00500);
            color: white;
            padding: 20px;
            font-size: 18px;
            border: none;
            box-shadow: 0 8px 20px rgba(225, 6, 0, 0.3);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        /* –°—Ç–∞—Ä—ã–π —Å—Ç–∏–ª—å hero-sub –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –±–∞–∑—É, –Ω–æ –∫–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ–º –º–µ–Ω—è—Ç—å —á–µ—Ä–µ–∑ JS */
        .hero-sub {
            font-size: 13px;
            opacity: 0.9;
            font-weight: 500;
            text-transform: uppercase;
        }
        .hero-title {
            font-size: 20px;
            font-weight: 800;
            line-height: 1.2;
        }
        .hero-date {
            font-size: 14px;
            background: rgba(0,0,0,0.2);
            padding: 4px 10px;
            border-radius: 20px;
            margin-top: 4px;
        }
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        /* –î–æ–±–∞–≤–∏–º —Å—Ç–∏–ª—å –¥–ª—è —Ç–∞–π–º–µ—Ä–∞ —Ç—É—Ç –∂–µ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è–ª—Å—è */
        .hero-timer {
            background: rgba(0, 0, 0, 0.3);
            padding: 6px 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
<div class="root">

    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
        <h2 style="margin:0;">Formula 1 Hub</h2>
    </div>

    <a href="next-race.html" class="btn hero-btn" id="hero-btn">
        <div class="hero-sub" id="hero-sub">–ë–õ–ò–ñ–ê–ô–®–ò–ô –≠–¢–ê–ü</div>

        <div id="hero-title" class="hero-title">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="hero-date" class="hero-date">--.--</div>

        <div id="hero-timer" class="hero-timer" style="display: none;">
            <span style="font-size:12px; opacity:0.8; margin-right:4px;">–î–æ —Å—Ç–∞—Ä—Ç–∞:</span>
            <span id="timer-val" style="font-family: monospace; font-weight: 700;">--:--:--</span>
        </div>
    </a>

    <div class="section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–π —ç—Ç–∞–ø</div>
    <div class="results-grid">
        <a href="race-results.html" class="menu-item">
            <span class="menu-icon">üèÅ</span>
            <span class="menu-label">–ì–æ–Ω–∫–∞</span>
        </a>
        <a href="quali-results.html" class="menu-item">
            <span class="menu-icon">‚è±</span>
            <span class="menu-label">–ö–≤–∞–ª–∞</span>
        </a>
    </div>

    <div class="section-title" id="season-title">–°–µ–∑–æ–Ω</div>

    <div class="menu-grid">
        <a href="drivers.html" class="menu-item">
            <span class="menu-icon">üë§</span>
            <span class="menu-label">–ü–∏–ª–æ—Ç—ã</span>
        </a>
        <a href="constructors.html" class="menu-item">
            <span class="menu-icon">üèéÔ∏è</span>
            <span class="menu-label">–ö–æ–º–∞–Ω–¥—ã</span>
        </a>
        <a href="season.html" class="menu-item full-width" style="flex-direction: row; justify-content: space-between; padding: 16px 24px;">
            <div style="display:flex; align-items:center; gap:12px;">
                <span class="menu-icon">üìÖ</span>
                <span class="menu-label">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
            </div>
            <span>‚ûú</span>
        </a>
    </div>

    <div class="section-title">–ú–æ—ë</div>
    <a href="favorites.html" class="menu-item full-width" style="flex-direction: row; justify-content: space-between; padding: 16px 24px; border-color: rgba(255, 215, 0, 0.3);">
        <div style="display:flex; align-items:center; gap:12px;">
            <span class="menu-icon">‚≠ê</span>
            <span class="menu-label" style="color: #ffd700;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
        </div>
        <span style="color: #ffd700;">‚ûú</span>
    </a>

</div>

<script src="/static/js/common.js"></script>
<script>
    let timerInterval;

    document.addEventListener('DOMContentLoaded', async () => {
        initTelegram();

        // 1. –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ì–û–î
        const currentYear = new Date().getFullYear();
        document.getElementById('season-title').textContent = `–°–µ–∑–æ–Ω ${currentYear}`;

        // 2. –ó–ê–ì–†–£–ó–ö–ê –ì–û–ù–ö–ò
        try {
            const data = await apiRequest('/api/next-race');
            const titleEl = document.getElementById('hero-title');
            const dateEl = document.getElementById('hero-date');
            const subEl = document.getElementById('hero-sub');
            const timerBlock = document.getElementById('hero-timer');
            const timerVal = document.getElementById('timer-val');

            if (data.status === 'ok') {
                titleEl.textContent = data.event_name;

                // --- –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –î–õ–Ø –ü–û–õ–ù–û–ô –î–ê–¢–´ ---
                if (data.local) {
                    // –¢–µ–ø–µ—Ä—å data.local = "08.03.2026 07:00"
                    // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é —á–∞—Å—Ç—å (–¥–æ –ø—Ä–æ–±–µ–ª–∞) -> "08.03.2026"
                    dateEl.textContent = data.local.split(' ')[0];
                } else {
                    dateEl.textContent = data.date;
                }
                // -----------------------------------

                if (data.next_session_iso && data.next_session_name) {
                    subEl.innerHTML = `<span class="session-badge">${data.next_session_name}</span>`;

                    const targetTime = new Date(data.next_session_iso).getTime();
                    timerBlock.style.display = 'block';

                    function updateTimer() {
                        const now = new Date().getTime();
                        const distance = targetTime - now;

                        if (distance < 0) {
                            clearInterval(timerInterval);
                            subEl.innerHTML = `<span class="session-badge" style="background: white; color: #e10600;">LIVE: ${data.next_session_name}</span>`;
                            timerVal.textContent = "–°–ï–°–°–ò–Ø –ò–î–ï–¢";
                            return;
                        }

                        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                        let text = "";
                        if (days > 0) text += `${days}–¥ `;
                        text += `${hours}—á ${minutes}–º ${seconds}—Å`;

                        timerVal.textContent = text;
                    }

                    updateTimer();
                    timerInterval = setInterval(updateTimer, 1000);
                } else {
                    subEl.textContent = "–ë–õ–ò–ñ–ê–ô–®–ò–ô –≠–¢–ê–ü";
                }

            } else if (data.status === 'season_finished') {
                titleEl.textContent = "–°–µ–∑–æ–Ω –∑–∞–≤–µ—Ä—à–µ–Ω";
                dateEl.style.display = 'none';
                subEl.textContent = "–î–û –í–°–¢–†–ï–ß–ò –í 2027!";
            } else {
                titleEl.textContent = "–ù–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è";
                dateEl.style.display = 'none';
            }
        } catch (e) {
            console.error(e);
            document.getElementById('hero-title').textContent = "–ë–ª–∏–∂–∞–π—à–∞—è –≥–æ–Ω–∫–∞";
        }
    });
</script>
</body>
</html>