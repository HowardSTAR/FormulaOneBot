<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–∫–∏</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
<div class="root">

    <a href="index.html" class="btn-back">
        ‚Üê <span>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</span>
    </a>
    <h2 id="race-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–∫–∏</h2>

    <div id="race-content">
        <div class="loading full-width">
            <div class="spinner"></div>
            <div>–ó–∞–≥—Ä—É–∂–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...</div>
        </div>
    </div>

</div>

<script src="/static/js/common.js"></script>
<script>
async function loadRaceResults() {
    const container = document.getElementById('race-content');
    const titleEl = document.getElementById('race-title');

    try {
        const data = await apiRequest('/api/race-results');

        if (!data.results || data.results.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <span class="empty-icon">üèÅ</span>
                    <div class="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                    <div class="empty-desc">–ì–æ–Ω–∫–∏ –≤ —ç—Ç–æ–º —Å–µ–∑–æ–Ω–µ –µ—â–µ –Ω–µ –ø—Ä–æ–≤–æ–¥–∏–ª–∏—Å—å –∏–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è.</div>
                </div>
            `;
            return;
        }

        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –¥–µ—Ç–∞–ª—è–º–∏ —Ç—Ä–∞—Å—Å—ã
        if (data.race_info) {
            titleEl.innerHTML = `
                <div>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–∫–∏</div>
                <div style="font-size: 14px; font-weight: 500; color: var(--text-secondary); margin-top: 4px;">
                    ${data.race_info.event_name}<br>
                    <span style="opacity:0.7">–≠—Ç–∞–ø ${data.round} ‚Ä¢ ${data.season}</span>
                </div>
            `;
        }

        let html = '<div class="standings-list" style="margin-top: 16px;">';

        data.results.forEach(result => {
            let posClass = 'pos-other';
            let emoji = '';

            // –ö—Ä–∞—Å–∏–≤—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ø–æ–¥–∏—É–º–∞
            if (result.position === 1) { posClass = 'pos-1'; emoji = 'ü•á'; }
            else if (result.position === 2) { posClass = 'pos-2'; emoji = 'ü•à'; }
            else if (result.position === 3) { posClass = 'pos-3'; emoji = 'ü•â'; }
            else { emoji = result.position; }

            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ (–∑–æ–ª–æ—Ç–∞—è —Ä–∞–º–∫–∞)
            const favoriteStyle = (result.is_favorite_driver || result.is_favorite_team)
                ? 'border: 1px solid rgba(255, 215, 0, 0.4); background: rgba(255, 215, 0, 0.05);'
                : '';

            html += `
                <div class="standings-item" style="${favoriteStyle}">
                    <div class="standings-position ${result.position <= 3 ? 'podium' : ''}" style="width: 35px;">
                        ${emoji}
                    </div>
                    <div class="standings-info">
                        <div class="standings-name">
                            ${result.is_favorite_driver ? '‚≠êÔ∏è ' : ''}${result.name}
                        </div>
                        <div class="standings-code">${result.team}</div>
                    </div>
                    <div class="standings-points" style="min-width: 40px; text-align: center;">
                        ${result.points > 0 ? result.points : ''}
                    </div>
                </div>
            `;
        });

        html += '</div>';
        container.innerHTML = html;

    } catch (e) {
        console.error(e);
        container.innerHTML = '<div style="color:red; text-align:center; padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    initTelegram();
    loadRaceResults();
});
</script>
</body>
</html>