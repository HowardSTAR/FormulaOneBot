<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–∫–∏ ‚Äî FormulaOneBot</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
<div class="root">
    <div class="card">
        <button id="btn-back-home" class="btn-back" type="button">‚Üê <span>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</span></button>
        <h2 id="race-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–∫–∏</h2>
        <div id="race-content">
            <div class="loading">
                <div class="spinner"></div>
                <p>–ó–∞–≥—Ä—É–∂–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...</p>
            </div>
        </div>
    </div>
</div>

<script src="/static/js/common.js"></script>
<script>
async function loadRaceResults() {
    const container = document.getElementById('race-content');
    const titleEl = document.getElementById('race-title');
    
    showLoading(container, '–ó–∞–≥—Ä—É–∂–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–∫–∏...');

    try {
        const data = await apiRequest('/race-results');
        
        if (!data.results || data.results.length === 0) {
            showEmpty(container, '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –≥–æ–Ω–∫–∏', 'üèÅ');
            return;
        }

        if (data.race_info) {
            titleEl.innerHTML = `
                –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–∫–∏<br>
                <span style="font-size: 14px; font-weight: normal; color: var(--text-muted);">
                    ${data.race_info.event_name} ‚Äî ${data.race_info.country}<br>
                    –≠—Ç–∞–ø ${data.round}, —Å–µ–∑–æ–Ω ${data.season}
                </span>
            `;
        }

        let html = '<div class="standings-list">';
        
        data.results.forEach(result => {
            const emoji = getPositionEmoji(result.position);
            const podiumClass = result.position <= 3 ? `podium-${result.position} podium` : '';
            const favoriteClass = (result.is_favorite_driver || result.is_favorite_team) ? 'favorite' : '';
            
            html += `
                <div class="standings-item ${podiumClass} ${favoriteClass}">
                    <div class="standings-position ${result.position <= 3 ? 'podium' : ''}">
                        ${emoji}${result.position}
                    </div>
                    <div class="standings-info">
                        <div class="standings-name">
                            ${result.is_favorite_driver ? '‚≠êÔ∏è ' : ''}${result.code} ${result.name}
                        </div>
                        <div class="standings-code">${result.team}</div>
                    </div>
                    <div class="standings-points">${formatPoints(result.points)}</div>
                </div>
            `;
        });

        html += '</div>';
        container.innerHTML = html;
    } catch (e) {
        console.error(e);
        showError(container, '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–Ω–∫–∏');
    }
}

document.addEventListener('DOMContentLoaded', () => {
    initTelegram();
    initBackButton('/');
    loadRaceResults();
});
</script>
</body>
</html>
