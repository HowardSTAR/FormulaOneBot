<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
<div class="root">

    <a href="index.html" class="btn-back">
        ‚Üê <span>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</span>
    </a>
    <h2 id="quali-title">–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è</h2>

    <div id="quali-content">
        <div class="loading full-width">
            <div class="spinner"></div>
            <div>–ó–∞–≥—Ä—É–∂–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã...</div>
        </div>
    </div>
</div>

<script src="/static/js/common.js"></script>
<script>
async function loadQualiResults() {
    const container = document.getElementById('quali-content');
    const titleEl = document.getElementById('quali-title');

    try {
        const data = await apiRequest('/api/quali-results');

        if (!data.results || data.results.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <span class="empty-icon">‚è±</span>
                    <div class="empty-title">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
                    <div class="empty-desc">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.</div>
                </div>
            `;
            return;
        }

        if (data.race_info) {
            titleEl.innerHTML = `
                <div>–ö–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏—è</div>
                <div style="font-size: 14px; font-weight: 500; color: var(--text-secondary); margin-top: 4px;">
                    ${data.race_info.event_name}<br>
                    <span style="opacity:0.7">–≠—Ç–∞–ø ${data.round} ‚Ä¢ ${data.season}</span>
                </div>
            `;
        }

        let html = '<div class="standings-list" style="margin-top: 16px;">';

        data.results.forEach(result => {
            let posClass = 'pos-other';
            let emoji = result.position;

            // –î–ª—è —Ç–æ–ø-3
            if (result.position === 1) emoji = 'ü•á';
            if (result.position === 2) emoji = 'ü•à';
            if (result.position === 3) emoji = 'ü•â';

            const time = result.best || '‚Äî';

            html += `
                <div class="standings-item">
                    <div class="standings-position" style="width: 35px; ${result.position <= 3 ? 'color: var(--text-primary);' : ''}">
                        ${emoji}
                    </div>
                    <div class="standings-info">
                        <div class="standings-name">${result.name || result.driver}</div>
                        <div class="standings-code">${result.driver}</div>
                    </div>
                    <div class="standings-time" style="font-family: monospace; font-size: 14px; background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 6px;">
                        ${time}
                    </div>
                </div>
            `;
        });

        html += '</div>';
        container.innerHTML = html;

    } catch (e) {
        console.error(e);
        container.innerHTML = '<div style="color:red; text-align:center; padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
    }
}

document.addEventListener('DOMContentLoaded', () => {
    initTelegram();
    loadQualiResults();
});
</script>
</body>
</html>